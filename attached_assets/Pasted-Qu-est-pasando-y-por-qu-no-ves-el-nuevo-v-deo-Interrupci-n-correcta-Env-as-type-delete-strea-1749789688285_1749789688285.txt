Qu√© est√° pasando y por qu√© no ves el nuevo v√≠deo
Interrupci√≥n correcta

Env√≠as {"type":"delete-stream","streamId":"‚Ä¶"} por WebSocket.

D-ID corta su flujo; t√∫ esperas 120 ms ‚Üí OK.

Cierre de la tuber√≠a

En cancelCurrentStream() ejecutas

ts
Copiar
stopAllRemoteTracks();      // los tracks se paran
peerConnectionRef.current?.close();   // üîí se cierra el RTCPeerConnection
peerConnectionRef.current = null;
Con eso destruyes completamente la sesi√≥n WebRTC que D-ID hab√≠a negociado.

Nuevo texto se env√≠a

Tu front hace el POST text y D-ID acepta el mensaje (por eso ves Text message sent), pero‚Ä¶

Para poder emitir el v√≠deo del ‚Äúnuevo turno‚Äù D-ID necesita otra conexi√≥n RTP (u offer/answer de renegociaci√≥n). Esa l√≥gica vive en tu funci√≥n connectWebRTC / createPeerConnection.

Como la peer‚Äêconnection est√° a null y no la recreas inmediatamente (ya no disparas connectWebRTC porque el estado no es ‚Äúneeds-reconnect‚Äù), no hay canal donde entregar el v√≠deo.

Eventos ausentes

Sin peer-connection activa, el backend de D-ID no llega a la fase de stream/started, chat/partial, etc. ‚Üí no aparecen en los logs y no se ve el avatar.

En resumen:

El nuevo mensaje s√≠ llega a D-ID, pero hemos cerrado la autopista por la que deb√≠a viajar el v√≠deo; el backend no puede arrancar un stream hasta que abras una peer-connection nueva o mantengas la existente.

Opciones conceptuales (sin tocar c√≥digo)
Estrategia	Qu√© implicar√≠a
No cerrar el RTCPeerConnection en interrupciones	Mantienes la canalizaci√≥n RTP viva; basta con parar los tracks para silenciar y dejar que la misma conexi√≥n transporte el stream siguiente.
Recrear la peer-connection justo antes de enviar el siguiente mensaje	Igual que haces al principio: renegociaci√≥n SDP ‚Üí stream/ready ‚Üí D-ID puede arrancar.
Reconectar s√≥lo si detectas que la PC est√° null	Ser√≠a un gatillo autom√°tico: si vas a enviar texto y no existe conexi√≥n, llamas primero a tu rutina de connectWebRTC.

Hasta que una de esas rutas se ponga en pr√°ctica, el flujo ‚Äúmensaje ‚Üí avatar habla‚Äù quedar√° cortado tras cada interrupci√≥n exitosa.







